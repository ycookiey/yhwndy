# ウィンドウ制御ツール 要件定義書

## 1. 概要

ウィンドウの透明化・枠消去等を行う常駐ツールの開発。作業効率と視認性の向上を目的とする。

---

## 2. 機能要件

### (1) 透明化 (Transparency)

| 項目 | 仕様 |
|------|------|
| 調整方法 | ショートカットによる段階調整（**5%刻み**） |
| 操作キー | 透明度UP / 透明度DOWN の**2キー方式** |
| 初期状態 | 不透明（100%） |
| 透明度範囲 | **5%〜100%**（0%は不可、視認性担保のため） |
| 複数ウィンドウ | 個別に透明度を管理（**ウィンドウハンドル単位、セッション中のみ**） |
| 永続化 | **なし**（ツール再起動時は100%にリセット） |
| 最小化→復元後 | 透明度を**維持** |

### (2) スタイル変更 (Borderless)

| 項目 | 仕様 |
|------|------|
| 枠消去 | タイトルバー・枠線の非表示 |
| 最大化ウィンドウ | **画面いっぱいに拡張**（フルスクリーン風）、タスクバーも隠す |
| タスクバーボタン | 維持（クリックで最小化・復元可能） |
| Alt+Tab | 維持（ウィンドウ一覧に表示） |
| 復元 | 標準スタイルへの復帰 |
| Aero Snap | **要調査**（実装時に動作確認して対応決定） |
| 閉じる等の代替 | OS標準ショートカットで代用（`Alt+F4`で閉じる、`Win+↑/↓`で最大化/最小化） |
| 複数モニター間移動 | **移動先モニターのサイズに自動調整** |
| 永続化 | **なし**（ツール再起動時は標準スタイルにリセット） |

### (3) 操作補助 (Manipulation)

| 項目 | 仕様 |
|------|------|
| 操作キー | **Ctrl+ドラッグ** で移動・リサイズを統合 |
| 移動 | ウィンドウ**中央領域**からドラッグ開始で移動 |
| リサイズ | ウィンドウ**端（角・辺）** からドラッグ開始でリサイズ |
| 端の判定距離 | **16px**（角は16x16px、辺は幅16px） |
| リサイズ方向 | ドラッグ開始位置で決定（左上→左上リサイズ等） |
| リサイズ動作 | OS標準のリサイズ（アスペクト比維持なし） |
| サイズ制限 | なし |
| 最大化ウィンドウ | **無視**（移動/リサイズ不可） |
| Ctrl離した場合 | **操作継続**（マウスボタンを離すまで） |
| カーソル形状 | **変更する**（移動時: 十字矢印、リサイズ時: 方向に応じたカーソル） |

#### 操作領域の図解

```
┌─────────────────────────────────────┐
│ 角:斜めリサイズ │   辺:縦リサイズ   │ 角:斜めリサイズ │
├─────────────────┼───────────────────┼─────────────────┤
│ 辺:横リサイズ   │     中央:移動     │  辺:横リサイズ  │
├─────────────────┼───────────────────┼─────────────────┤
│ 角:斜めリサイズ │   辺:縦リサイズ   │ 角:斜めリサイズ │
└─────────────────┴───────────────────┴─────────────────┘
※ 端の判定距離: 16px
```

### (4) 対象選択 (Targeting)

| 項目 | 仕様 |
|------|------|
| 対象 | **アクティブウィンドウのみ** |
| 子ウィンドウ選択時 | **トップレベルウィンドウ**（最上位）を対象とする |
| 同一アプリ複数インスタンス | **ウィンドウごとに個別管理**（セッション中のみ） |
| 識別方法 | ウィンドウハンドル（HWND） |

### (5) Ghost Mode（距離ベース透明度制御）

マウス距離に応じて自動的に透明度を調整する機能。

| 項目 | 仕様 |
|------|------|
| 更新間隔 | 100ms |
| 距離算出 | **ウィンドウ端からの最短距離**（最近接点方式） |
| 完全透明距離 | ウィンドウ端から50px未満（**内部も完全透明**） |
| フェード距離 | 50px〜150px（**線形補間**: 50px=0%, 150px=設定Opacity） |
| 通常表示距離 | 150px以上（設定Opacityで表示） |
| 一時解除 | **Ctrl押下中は距離に関わらず設定Opacityで固定** |
| 対象範囲 | **ウィンドウごとにON/OFF**（個別指定） |
| トグル方法 | **ホットキー**でアクティブウィンドウのGhost Mode切替 |
| 非アクティブ時 | **継続**（バックグラウンドでも透明度制御） |
| 永続化 | **なし**（ツール再起動時はOFFにリセット） |
| 手動透明度変更 | Ghost Mode中でも透明度UP/DOWNで**通常時の透明度（最大不透明度）を変更可能** |

---

## 3. UI/UX要件

| 項目 | 仕様 |
|------|------|
| 形態 | タスクトレイ常駐型 |
| 入力 | グローバルホットキー主体 |
| カスタマイズ | ホットキーのカスタマイズは不可 |
| 競合時 | 無視（エラー通知なし） |
| 起動時ホットキー登録失敗 | **トースト通知**（「一部ホットキーが登録できませんでした」） |
| 除外ウィンドウへの操作 | **無視**（何も起きない） |
| 複数起動 | **禁止**（2つ目は静かに終了） |
| 設定画面 | **なし** |
| Aboutダイアログ | **なし** |

### タスクトレイメニュー

| メニュー項目 | 内容 |
|--------------|------|
| 状態表示 | 透明度変更・枠消去・Ghost ModeのいずれかがONのウィンドウのみ表示 |
| 状態表示の更新 | 変更があった時点でキャッシュを更新 |
| スタートアップ登録 | チェックボックスでON/OFF切替 |
| 緊急リセット | 全ウィンドウの透明度・枠消去・Ghost Modeをリセット |
| 終了 | ツール終了（全スタイル復元後に終了） |

### ホットキー割り当て（デフォルト）

| 機能 | ホットキー |
|------|-----------|
| 透明度UP | `Ctrl+Alt+↑` |
| 透明度DOWN | `Ctrl+Alt+↓` |
| 枠消去/復元トグル | `Ctrl+Alt+B` |
| Ghost Mode トグル | `Ctrl+Alt+G` |
| 移動/リサイズ | `Ctrl+ドラッグ` |

---

## 4. 技術要件

### 開発環境

| 項目 | 選定 |
|------|------|
| 言語 | C# |
| フレームワーク | WinForms |
| ランタイム | .NET 8（単一ファイル配布 or 自己完結型） |

### 必須 Win32 API

| 用途 | API |
|------|-----|
| スタイル | `Get/SetWindowLong` (GWL_STYLE, WS_CAPTION OFF) |
| 透明化 | `SetLayeredWindowAttributes` (WS_EX_LAYERED) |
| 移動・変形 | `SetWindowPos`, `SendMessage` (WM_SYSCOMMAND) |
| 入力 | `RegisterHotKey`, `GetAsyncKeyState` |

### 対応環境

| 項目 | 対応 |
|------|------|
| マルチモニター | 対応（移動先モニターサイズに自動調整） |
| 高DPI（125%,150%等） | 対応（DPIAware宣言） |

---

## 5. 設定・永続化

| 項目 | 仕様 |
|------|------|
| 永続化先 | **レジストリのみ**（config.json不使用） |
| 永続化対象 | スタートアップ登録のON/OFFのみ |
| 自動起動 | スタートアップ登録機能あり（レジストリで管理） |
| ウィンドウ状態管理 | **セッション中のみ**（ツール終了時にクリーンアップ） |
| ツール終了時 | **全スタイル完全復元**（透明度100%、枠復元、Ghost Mode OFF） |

### 除外ウィンドウ

以下のウィンドウは操作対象外とする：

- デスクトップ
- タスクバー
- スタートメニュー
- 本ツール自身

---

## 6. 安全性・リスク管理

| 項目 | 仕様 |
|------|------|
| 復元方法 | 終了フックで全スタイルを完全復元 |
| 緊急リセット | タスクトレイメニューから実行（透明度＋枠消去＋Ghost Mode全リセット） |
| 権限 | 管理者権限アプリ操作時は本ツールも管理者実行が必要 |

---

## 7. 未確定事項

| 項目 | 状況 |
|------|------|
| Aero Snap対応 | 実装時に動作確認して対応決定 |